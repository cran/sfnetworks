<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-04-09" />

<title>2. Network pre-processing and cleaning</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">2. Network pre-processing and cleaning</h1>
<h4 class="date">2024-04-09</h4>



<STYLE type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</STYLE>
<p>Unfortunately real-world datasets are not always as friendly as those
used in tutorials. Pre-processing of the data will often be needed, as
well as cleaning the network after construction. This vignette presents
some examples that may be of use when going through this phase.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(sfnetworks)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span></code></pre></div>
<div id="common-pre-processing-tasks" class="section level2">
<h2>Common pre-processing tasks</h2>
<div id="rounding-coordinates" class="section level3">
<h3>Rounding coordinates</h3>
<p>You might have a set of lines in which some endpoints are
<em>almost</em> shared between two lines. However, the coordinates are
stored with so much precision that there is a minor difference between
the two points. When constructing a sfnetwork these lines will
<em>not</em> be connected because the points are not <em>exactly</em>
equal.</p>
<p>We can pre-process the lines by reducing the precision of the
coordinates such that the points become <em>exactly</em> equal. A tiny
example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">51</span>))</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">52</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">8.000001</span>, <span class="fl">52.000001</span>))</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">52</span>))</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>l1 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p1, p2)))</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>l2 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p3, p4)))</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>edges <span class="ot">=</span> <span class="fu">st_as_sf</span>(<span class="fu">c</span>(l1, l2), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># The edges are not connected.</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="fu">as_sfnetwork</span>(edges)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A sfnetwork with</span> <span style="color: #555555;">4</span> <span style="color: #555555;">nodes and</span> <span style="color: #555555;">2</span> <span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span> <span style="color: #555555;">EPSG:4326</span> <span style="color: #555555;">
#&gt; #
#&gt; # A rooted forest with 2 trees with spatially explicit edges
#&gt; #
#&gt; # A tibble: 4 × 1</span>
#&gt;               x
#&gt;     <span style="color: #555555; font-style: italic;">&lt;POINT [°]&gt;</span>
#&gt; <span style="color: #555555;">1</span>        (7 51)
#&gt; <span style="color: #555555;">2</span>        (8 52)
#&gt; <span style="color: #555555;">3</span> (8.000001 52)
#&gt; <span style="color: #555555;">4</span>        (7 52)
#&gt; <span style="color: #555555;">#
#&gt; # A tibble: 2 × 3</span>
#&gt;    from    to                   x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span>    <span style="color: #555555; font-style: italic;">&lt;LINESTRING [°]&gt;</span>
#&gt; <span style="color: #555555;">1</span>     1     2        (7 51, 8 52)
#&gt; <span style="color: #555555;">2</span>     3     4 (8.000001 52, 7 52)
</CODE></PRE>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Round coordinates to 0 digits.</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">st_geometry</span>(edges) <span class="ot">=</span> <span class="fu">st_geometry</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(edges))</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># The edges are connected.</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">as_sfnetwork</span>(edges)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A sfnetwork with</span> <span style="color: #555555;">3</span> <span style="color: #555555;">nodes and</span> <span style="color: #555555;">2</span> <span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span> <span style="color: #555555;">EPSG:4326</span> <span style="color: #555555;">
#&gt; #
#&gt; # A rooted tree with spatially explicit edges
#&gt; #
#&gt; # A tibble: 3 × 1</span>
#&gt;             x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;POINT [°]&gt;</span>
#&gt; <span style="color: #555555;">1</span>      (7 51)
#&gt; <span style="color: #555555;">2</span>      (8 52)
#&gt; <span style="color: #555555;">3</span>      (7 52)
#&gt; <span style="color: #555555;">#
#&gt; # A tibble: 2 × 3</span>
#&gt;    from    to                x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;LINESTRING [°]&gt;</span>
#&gt; <span style="color: #555555;">1</span>     1     2     (7 51, 8 52)
#&gt; <span style="color: #555555;">2</span>     2     3     (8 52, 7 52)
</CODE></PRE>
<p>Note that too much rounding can create linestring geometries of zero
length, with the same start and endpoint. This may cause problems
later.</p>
</div>
<div id="dealing-with-one-way-edges" class="section level3">
<h3>Dealing with one-way edges</h3>
<p>In <code>sfnetworks</code> you can create directed and undirected
networks. In directed ones, an edge can only be traveled from its start
node to its end node. In undirected ones, an edge can be traveled both
ways. However, in the real world there are networks where <em>some</em>
edges can be traveled both ways and <em>some</em> edges only one way.
For example, a road network in a city where there are one-way
streets.</p>
<p>Unfortunately, neither <code>igraph</code> nor <code>tidygraph</code>
provides an interface for such networks. Therefore, the only way to deal
with this is to create a directed network but first <em>duplicate</em>
and <em>reverse</em> all edge linestrings that can be traveled both
ways.</p>
<p>See the small example below, where we have three lines with one-way
information stored in a <em>oneway</em> column. One of the lines is a
one-way street, the other two are not. By duplicating and reversing the
two linestrings that are not one-way streets, we create a directed
network that correctly models our situation. Note that reversing
linestrings using <code>sf::st_reverse()</code> only works when sf links
to a GEOS version of at least 3.7.0.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">51</span>))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">52</span>))</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">52</span>))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>l1 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p1, p2)))</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>l2 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p1, p3)))</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>l3 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p3, p2)))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>edges <span class="ot">=</span> <span class="fu">st_as_sf</span>(<span class="fu">c</span>(l1, l2, l3), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>edges<span class="sc">$</span>oneway <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>edges</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 3 features and 1 field</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;                         x oneway</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; 1 LINESTRING (7 51, 7 52)   TRUE</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; 2 LINESTRING (7 51, 8 52)  FALSE</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; 3 LINESTRING (8 52, 7 52)  FALSE</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>duplicates <span class="ot">=</span> edges[<span class="sc">!</span>edges<span class="sc">$</span>oneway, ]</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>reversed_duplicates <span class="ot">=</span> <span class="fu">st_reverse</span>(duplicates)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>edges <span class="ot">=</span> <span class="fu">rbind</span>(edges, reversed_duplicates)</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>net <span class="ot">=</span> <span class="fu">as_sfnetwork</span>(edges)</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="fu">activate</span>(net, <span class="st">&quot;edges&quot;</span>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A sfnetwork with</span> <span style="color: #555555;">3</span> <span style="color: #555555;">nodes and</span> <span style="color: #555555;">5</span> <span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span> <span style="color: #555555;">EPSG:4326</span> <span style="color: #555555;">
#&gt; #
#&gt; # A directed simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # A tibble: 5 × 4</span>
#&gt;    from    to oneway                x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #555555; font-style: italic;">&lt;LINESTRING [°]&gt;</span>
#&gt; <span style="color: #555555;">1</span>     1     2 TRUE       (7 51, 7 52)
#&gt; <span style="color: #555555;">2</span>     1     3 FALSE      (7 51, 8 52)
#&gt; <span style="color: #555555;">3</span>     3     2 FALSE      (8 52, 7 52)
#&gt; <span style="color: #555555;">4</span>     3     1 FALSE      (8 52, 7 51)
#&gt; <span style="color: #555555;">5</span>     2     3 FALSE      (7 52, 8 52)
#&gt; <span style="color: #555555;">#
#&gt; # A tibble: 3 × 1</span>
#&gt;             x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;POINT [°]&gt;</span>
#&gt; <span style="color: #555555;">1</span>      (7 51)
#&gt; <span style="color: #555555;">2</span>      (7 52)
#&gt; <span style="color: #555555;">3</span>      (8 52)
</CODE></PRE>
</div>
</div>
<div id="network-cleaning-functions" class="section level2">
<h2>Network cleaning functions</h2>
<p>The <code>sfnetworks</code> package contains a set of spatial network
specific cleaning functions. They are implemented as <em>spatial morpher
functions</em>. To learn more about spatial morphers and what they are,
see the <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn05_morphers.html">dedicated
vignette</a> for that. For now, it is sufficient to know that you can
use any spatial morpher function inside the
<code>tidygraph::convert()</code> verb to convert your network into a
different state.</p>
<p>Before presenting the cleaning functions that are currently
implemented, lets create a network to be cleaned.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>p5 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>p6 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>p7 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>p8 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>p9 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>))</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>p10 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">0</span>))</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>p11 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>))</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>p12 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">0</span>))</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>p13 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>p14 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">5.8</span>, <span class="dv">1</span>))</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>p15 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="fl">1.2</span>))</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>p16 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">6.2</span>, <span class="dv">1</span>))</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>p17 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="fl">0.8</span>))</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>p18 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">2</span>))</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>p19 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>p20 <span class="ot">=</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">1</span>))</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>l1 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p1, p2, p3)))</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>l2 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p3, p4, p5)))</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>l3 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p6, p4, p7)))</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>l4 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p8, p11, p9)))</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>l5 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p9, p5, p10)))</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>l6 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p8, p9)))</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>l7 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p10, p12, p13, p10)))</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>l8 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p5, p14)))</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>l9 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p15, p14)))</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>l10 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p16, p15)))</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>l11 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p14, p17)))</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>l12 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p17, p16)))</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>l13 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p15, p18)))</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>l14 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p17, p19)))</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>l15 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">c</span>(p16, p20)))</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>lines <span class="ot">=</span> <span class="fu">c</span>(l1, l2, l3, l4, l5, l6, l7, l8, l9, l10, l11, l12, l13, l14, l15)</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>edge_colors <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">rep</span>(<span class="fu">sf.colors</span>(<span class="dv">12</span>, <span class="at">categorical =</span> <span class="cn">TRUE</span>)[<span class="sc">-</span><span class="dv">2</span>], <span class="dv">2</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ecount</span>(x))]</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>net <span class="ot">=</span> <span class="fu">as_sfnetwork</span>(lines)</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(net), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAHgCAMAAABKCk6nAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAICklEQVR4nO3d23bbNhQGYblV3Kbu+z9v7djyFnQESEHMP525ygWJTelby9YhJnb/Grrd1hdgcxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIGr3XtbX8PD4z2ixe12RGHcA1rcbocUpj2exe12TGHYw1mewPAEhicwvYPvy9YX8tgE/u7L94UlLHD15csSFrj6870XmrDA1QfwvzRhgatfwDRhgatPYJiwwNUXMEtY4OoAjBIWuPoGJgkLXBUwSFjg6giYIyxwdQyMERa4aoApwgJXLTBEWODqBJghLHB1CowQFrg6AyYIC1ydAwOEBa4uAOcLC1xdAo4XFri6CJwuLHB1GThcWODqCnC2sMDVNeBoYYGrq8DJwgJX14GDhQWubgDnCgtc3QKOFRa4ugmcKixwdRs4VFjg6g5wprDA1T3gSGGBq7vAicICV/eBA4UFrjqA84QFrnqA44QFrrqA04QFrvqAw4QFrjqBs4QFrnqBo4QFrrqBk4QFrvqBg4QFrgaAc4QFrkaAY4QFroaAU4QFrsaAQ4QFrgaBM4QFrkaBI4QFroaBE4QFrsaBA4RxwCt2XVhy6mrh2btE0IBX7Kux7NSVwtP3AYEBr9g5Zempq4Tn7/TCAl6xN06d+rKoZ19v94hpK2/RhsCLhAUeTODzEdNW3iKBz0dMW3mTNniRtSpfZI224vnawNe3SeOteL428PWDjuH+fm/hqf+899Br6enHezPXF7gSOCGB2wSuBE5I4DaBK4ETErhN4ErghARuE7gSOCGB2wSuBE5I4DaBK4ETErhN4ErghARuE7gSOCGB2wSuBE5I4DaBK4ETErhN4ErghARuE7gSOCGB2wSuBE5I4DaBK4ETErhN4ErghARuE7gSOCGB2wSuBE5I4DaBq02AvcvOYGHA3idrtCxg73Q3XBSw96ocT+CTEdNW3iiBT0ZMW3mjBD4ZMW3ljYoC3h98X6eNELh6OvB+/yX8+jpNWODq2cD7/Zfw6+s8YYGrJwP/8t1//Ot1ovB94LDbZK8Aftoj/TWofA/Cg/P7Dr97SNqN7pcDP+2Rfg468v0UHpzfefi9I+K2qlgM/LRHehh05PshPDi/9/A7B9QbtT+eVw39Md4H8ILTftTQv+ZWg/aXn+muTXzqcIF/W+Arz7TAAgsscCewL7Ie32HQ26r5vYf7NukRQ5cMentrhA8/uAZXuX9Y10LdUx/V8qEpH3S8vTXCh19Ng6t0HDV8db95KR9VvjXCny8+ZswRuHruZ9HHwvN8BT7qyV82fArXO5Q5UwSunv114cH3U3jSEIGrp3/hf/D9EJ41Q+DK/5OVkMAnI6atvFECn4yYtvJGCXwyYtrKGxUF7N8mjZcF7F8XDhcG7N8Hj5YGvOJ6uxK4EjghgdsErgROSOA2gSuBExK4TeBK4IQEbhO4EjghgdsErgROSOA2gSuBExK4TeBK4IQEbhO4EjghgdsErgROSOA2gSuBExK4TeBK4IQEbhO4EjghgdsErgROSOA2gSuBExK4TeBK4IQEbhO4EjghgdsErgROSOA2HPCKu9Zscm97gcdacd+pTXanEHisFXeOm3/TuYsJPNKKez/WqT8XtfSSBR5pQ+ClwgKPJPBZAp+dKvBv3ANeZC2REvhprX6btIhK4Oe18oOOZT9tBY5p2e9TgXNaJCxwUEuEBU5qgbDAUY0LC5zVsLDAYY0KC5zWoLDAcY0JC5zXkLDAgY0IC5zYgLDAkfULC5xZt7DAofUKC5xap7DAsfUJC5xbl7DAwfUIC5xch7DA0d0XFji7u8ICh3dPWOD07ggLHN9tYYHzuyksMKBbwgITuiEsMKLrwgIzuiosMKRrwgJTuiIsMKbLwgJzuigsMKhLwgKTuiAsMKpzYYFZnQkLDOtUWGBaJ8IC42qFBebVCAsM7FhYYGJHwgIjK2GBmX0LCwztICwwtS9hgbH9/G7hArO3ahJ4ZSuBp2/GJfDaVgHP325N4NWtAF6xDVD3iGkr/38SmJ7A9AS2y/kii55vk+j5QYetSmB4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMDyB4QkMT2B4AsMTGJ7A8ASGJzA8geEJDE9geALDExiewPAEhicwPIHhCQxPYHgCwxMYnsDwBIYnMLz/ABg4lewhTZMnAAAAAElFTkSuQmCC" /><!-- --></p>
<div id="simplify-network" class="section level3">
<h3>Simplify network</h3>
<p>A network may contain sets of edges that connect the same pair of
nodes. Such edges can be called <em>multiple edges</em>. Also, it may
contain an edge that starts and ends at the same node. Such an edge can
be called a <em>loop edge</em>.</p>
<p>In graph theory, a <em>simple graph</em> is defined as a graph that
does <em>not</em> contain multiple edges nor loop edges. To obtain a
simple version of our network, we can remove multiple edges and loop
edges by calling tidygraphs edge filter functions
<code>tidygraph::edge_is_multiple()</code> and
<code>tidygraph::edge_is_loop()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>simple <span class="ot">=</span> net <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">edge_is_multiple</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">edge_is_loop</span>())</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(net), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(simple), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEKUlEQVR4nO3c7VLqMBgA4arAUeH+r/eUUpSPJttpJOEtu7+csU3CIxaUQHewbF3rBTx7AkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBzw7UdY1X+ORAXdda6LmBuq65kEC0hJaTYwJRg8/bW8sVNJx7Rh+DT0uhZwfqe2sqFAWomVAAoENToQhATYVCALUUigHUUCgIUDuhKEDNhMIAtRKKA9RIKBBQG6FIQE2EQgG1EIoF1EAoGFB9oWhA1YXCAdUWigdUWSggUF2hiEBVhUIC1RSKCVRRKChQPaGoQNWEwgLVEooLVEmo9fYk2JnwkTtgnlDh5ofGu5No78a4eSFb4RS0xIJzi8PdLeMBBULFG2gEojUuP7U8gXD2Wdegx05B5xfNXtonLf67eAPeNvSj2Gdf9oDvvrIptn0l5wsECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkErR/If9rnC/6yz8OBgr9wKBD0cKDNCLRbPMK6gTabk9But1goB1T+uSs0AgMVrKE/dXMS6n126YHyU9DWiveShhG2mY5Aue9vhxH+LWo4tQfqb8nJJ7FLhDaY5H2KhMYRCoDGERb79ELDbdml99HQVXztQNc3RqAE0PsjgGpsXsKLdMEahlP3++OX5x/WkinW/Si23x+Fznfn9HG5UZZO/yc9+HnQ0Wc/XiaWjrFqoMPJ5yi0eIh1Ax32dA3GVg7kH6uUQFTpk5XVA+FWbGj9QDQFJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBC0+g83iQ2Er8kMB3zly08RGghf1RsPKBESSKAXBpp9DUofsHIg3sQ23n+S31870Izyv0YCgZBAh7yQQMcyQgINpYUEOpUUEmgsJSTQuYSQQD9NCwn026SQQBdNCQl02YSQQFfdCwl03Z2QQDfdCgl0242QQHddCwl035WQQBNdCgk01YWQQJP9Cgk03Y+QQInOQgKlGoUESvb1U/aw1wU6CETNAwr9rufC5gDFft98aQwU/JMXihOIEqi0174GzemVH8VqJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBD0H4dX3mb6nsCOAAAAAElFTkSuQmCC" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAD1klEQVR4nO3cwXLaOgBAUdJHoWnz/99bINm8BZwMKhZi7l1lJrYkn4UhsWD3UTfbzV7AsxcQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIPTsQLvd5BU+OdBuN1vouYF2u+lCAWkJMydnAamLz9vbzBVMnPs7XXxmCj070MfH29tUoecHmiy0ANBcoRWApgotATRTaA2giUKLAM0TWgVomtAyQLOE1gGaJLQQ0ByhlYCmCC0FNENoLaAJQosBbS+0GtDmQssBbS20HtDGQgsCbSu0ItCmQksCbSm0JtCGQosCbSe0KtBmQssCbSW0LtBGQrO3J2lnwq0Dvic0uPlh8u4k7d342rxws8EptMSBc4fj7pavAwaEhjfQBKQ13n/qeAFx9m/dgx47hc4fmn20X1r87+ENeH+WfhX7dermAb9PjU3x59TI+QGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBA6PWB+qf97RZ/7PNwoMUfHAaEHg70/gV0vHuE1wZ6f/8UOh7vFroFNP69KxrBQANrOJ36/il08jleH+j2FNpa8WOkywg/b3QGuvX7n5cR/rury6knoNOVfPpcWYo2mNz2GRL6GmEA6GuEu31OQpdrOV5fiu7irw70/4sJ6ArQ4RFAW2xe4k16YA2XU/f784+Hw+H6QHffg17hVWy/PwsdDp9C14+7Ncq90/+THvw+6OyzP13/GejeMV4a6OPT5yx09xCvDfSx1z2YvThQf6yqgNTom5WXB/ox+Gbl9YFOjZwfEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYRe/stN1gbiM5nxHSZLA/Gp3vBjv4BYQGhpoO5Bnn7kiya/1eJAjy8gFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBBa+1PPG7T25+Yf3+LfvPD4AkIBqe5BqlexxxYQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQ+gsdDuIJtPs6NgAAAABJRU5ErkJggg==" width="50%" /></p>
<p>Note that removing multiple edges in that way always <em>keeps</em>
the <em>first</em> edge in each set of multiple edges, and drops all the
other members of the set. Hence, the resulting network does not contain
multiple edges anymore, but the connections between the nodes are
preserved. Which of the multiple edges is the first one in a set depends
on the order of the edges in the edges table. That is, by re-arranging
the edges table before applying the filter you can influence which edges
are kept whenever sets of multiple edges are detected. For example, you
might want to always keep the edge with the shortest distance in the
set.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>simple <span class="ot">=</span> net <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">edge_length</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">edge_is_multiple</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">edge_is_loop</span>())</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(net), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(simple), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEKUlEQVR4nO3c7VLqMBgA4arAUeH+r/eUUpSPJttpJOEtu7+csU3CIxaUQHewbF3rBTx7AkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBzw7UdY1X+ORAXdda6LmBuq65kEC0hJaTYwJRg8/bW8sVNJx7Rh+DT0uhZwfqe2sqFAWomVAAoENToQhATYVCALUUigHUUCgIUDuhKEDNhMIAtRKKA9RIKBBQG6FIQE2EQgG1EIoF1EAoGFB9oWhA1YXCAdUWigdUWSggUF2hiEBVhUIC1RSKCVRRKChQPaGoQNWEwgLVEooLVEmo9fYk2JnwkTtgnlDh5ofGu5No78a4eSFb4RS0xIJzi8PdLeMBBULFG2gEojUuP7U8gXD2Wdegx05B5xfNXtonLf67eAPeNvSj2Gdf9oDvvrIptn0l5wsECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkErR/If9rnC/6yz8OBgr9wKBD0cKDNCLRbPMK6gTabk9But1goB1T+uSs0AgMVrKE/dXMS6n126YHyU9DWiveShhG2mY5Aue9vhxH+LWo4tQfqb8nJJ7FLhDaY5H2KhMYRCoDGERb79ELDbdml99HQVXztQNc3RqAE0PsjgGpsXsKLdMEahlP3++OX5x/WkinW/Si23x+Fznfn9HG5UZZO/yc9+HnQ0Wc/XiaWjrFqoMPJ5yi0eIh1Ax32dA3GVg7kH6uUQFTpk5XVA+FWbGj9QDQFJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBC0+g83iQ2Er8kMB3zly08RGghf1RsPKBESSKAXBpp9DUofsHIg3sQ23n+S31870Izyv0YCgZBAh7yQQMcyQgINpYUEOpUUEmgsJSTQuYSQQD9NCwn026SQQBdNCQl02YSQQFfdCwl03Z2QQDfdCgl0242QQHddCwl035WQQBNdCgk01YWQQJP9Cgk03Y+QQInOQgKlGoUESvb1U/aw1wU6CETNAwr9rufC5gDFft98aQwU/JMXihOIEqi0174GzemVH8VqJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBD0H4dX3mb6nsCOAAAAAElFTkSuQmCC" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADdUlEQVR4nO3c3VKbUBhAURJrm1bf/3lLfm4607BmchoJdO8rHeUDljMQ5cTpsxab1j6AVy8gFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQOjVgaZp5SN8caBpWlvotYGmaXWhgHQIa+6cBaRW93l1oJ9r+7w80Ny6RxAQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQWvvBLp4s/4NHz4MTVl4ZoLUJ44sXRiesu7REq1vGl78MTwhIAwZ2PlxA3HvXoOWOOvj34bvY26bvYse5xW94nxvbxdvcyPYBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQGj/QP3RfrmNP/Z5OtDGHxwGhJ4OdLwBPT5k30Dz+KvP41OWgJ6/eMlAA8cwb3q8Cp2Z7w9a3oWWVnwf6TLhY6HzCSx9/eMy4cdDXTa9/gCuPtP0629pgcmyz5DQbcIA0G3Cwz6z0OVc3m+f3fNZENo70J8nE9AdoMMzgL5i8RIv0gPHcNn0dDp/eDgc7g96+Bq0h7vY6XQWOhyuQve/b2nKo7v/Jz35ddDZ5zSf/xno0Rm7Bvq8+pyFHh6xb6DPk67BbOdA/bKqAlKjL1Z2D/Rt8MXK/oHmRrYPCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkK7/+cm2wbiM5nxFSabBuJTveHHfgGxgNCmgboGefc6/f/8LvYFBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQtt+1/MXtO33zT+/jf/nhecXEApIdQ1S3cWeW0AoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEDoN9GE784p5TG9AAAAAElFTkSuQmCC" width="50%" /></p>
<p>By arranging the edges table first, you can influence <em>which</em>
edge in a set of multiple edges is kept. However, this way of
simplifying still selects a single edge from the set, and drops all the
others. When your edges have attributes, you might prefer to
<em>merge</em> the edges in a set into a single new edge. This new edge
has the geometry of the first edge in the set, but its attribute values
are a combination of the attributes of all the edges in the set. This is
exactly what the function <code>to_spatial_simple()</code> does. It has
an argument <code>summarise_attributes</code> that lets you specify
exactly how you want to merge the attributes of each set of multiple
edges.</p>
<p>How attributes should be combined is of course dependent on the type
and purpose of each attribute. Therefore, the combination technique can
be specified on a per-attribute basis. There are two ways to specify the
combination technique for an attribute:</p>
<ul>
<li>As a character, referring to the name of a pre-defined combination
technique in <code>igraph</code>. Examples include <code>mean</code>,
<code>sum</code>, <code>first</code> and <code>last</code>. See <a href="https://igraph.org/r/doc/igraph-attribute-combination.html">here</a>
for an overview of all implemented techniques.</li>
<li>As a function, taking a vector of attribute values as input and
returning a single value. This is helpful when you want to combine
attributes in a way that is not pre-defined in <code>igraph</code>.</li>
</ul>
<p>Providing a single character or a single function
(e.g. <code>summarise_attributes = &quot;sum&quot;</code>) will apply the same
technique to each attribute. Instead, you can provide a named list with
a different technique for each attribute. This list can also include one
unnamed element containing the technique that should be applied to all
attributes that were not referenced in any of the other elements. Note
that the geometry-list column, the tidygraph index column, as well as
the <em>from</em> and <em>to</em> columns are not attributes!</p>
<p>The analogue of this in tidyverse terms is a
<code>dplyr::group_by()</code> operation followed by a
<code>dplyr::summarise()</code> call. The groups in this case are
defined by the start and end node indices of the edges. Edges that
connect the same pair of nodes (i.e. multiple edges) are in the same
group. Then, attributes are summarised into a single value for each
group separately.</p>
<p>Enough theory! Lets look at a practical example instead. We will
first add some attribute columns to the edges, and then specify
different combination techniques when simplifying the network.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Add some attribute columns to the edges table.</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>flows <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">ecount</span>(net), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>types <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;path&quot;</span>, <span class="dv">8</span>), <span class="fu">rep</span>(<span class="st">&quot;road&quot;</span>, <span class="dv">7</span>))</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>foo <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ecount</span>(net)), <span class="fu">ecount</span>(net))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>bar <span class="ot">=</span> <span class="fu">sample</span>(letters, <span class="fu">ecount</span>(net))</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>net <span class="ot">=</span> net <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">edge_length</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flow =</span> flows, <span class="at">type =</span> types, <span class="at">foo =</span> foo, <span class="at">bar =</span> bar)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>net</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A sfnetwork with</span> <span style="color: #555555;">15</span> <span style="color: #555555;">nodes and</span> <span style="color: #555555;">15</span> <span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span> <span style="color: #555555;">NA</span> <span style="color: #555555;">
#&gt; #
#&gt; # A directed multigraph with 3 components with spatially explicit edges
#&gt; #
#&gt; # A tibble: 15 × 7</span>
#&gt;    from    to              x  flow type    foo bar  
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span>   <span style="color: #555555; font-style: italic;">&lt;LINESTRING&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>
#&gt; <span style="color: #555555;">1</span>    10     9 (6 1.2, 5.8 1)     2 path      5 c    
#&gt; <span style="color: #555555;">2</span>    11    10 (6.2 1, 6 1.2)     2 path      8 x    
#&gt; <span style="color: #555555;">3</span>     9    12 (5.8 1, 6 0.8)    10 path     13 b    
#&gt; <span style="color: #555555;">4</span>    12    11 (6 0.8, 6.2 1)     5 path      9 k    
#&gt; <span style="color: #555555;">5</span>    11    15   (6.2 1, 7 1)     4 path      7 p    
#&gt; <span style="color: #555555;">6</span>    10    13   (6 1.2, 6 2)     6 path      2 q    
#&gt; <span style="color: #555555;"># ℹ 9 more rows</span>
#&gt; <span style="color: #555555;">#
#&gt; # A tibble: 15 × 1</span>
#&gt;         x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;POINT&gt;</span>
#&gt; <span style="color: #555555;">1</span>   (0 1)
#&gt; <span style="color: #555555;">2</span>   (2 1)
#&gt; <span style="color: #555555;">3</span>   (4 1)
#&gt; <span style="color: #555555;"># ℹ 12 more rows</span>
</CODE></PRE>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># We know from before that our example network has one set of multiple edges.</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"># Lets look at them.</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>net <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">edge_is_between</span>(<span class="dv">6</span>, <span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; Simple feature collection with 2 features and 6 fields
#&gt; Geometry type: LINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 4 ymin: 2 xmax: 5 ymax: 3
#&gt; CRS:           NA
#&gt; <span style="color: #555555;"># A tibble: 2 × 7</span>
#&gt;    from    to               x  flow type    foo bar  
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span>    <span style="color: #555555; font-style: italic;">&lt;LINESTRING&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>
#&gt; <span style="color: #555555;">1</span>     6     7      (4 3, 4 2)     6 path     11 r    
#&gt; <span style="color: #555555;">2</span>     6     7 (4 3, 5 2, 4 2)     9 road     10 y
</CODE></PRE>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Define how we want to combine the attributes.</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co"># For the flows:</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co"># --&gt; It makes sense to sum them when edges get merged.</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># For the type:</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co"># --&gt; Preserve the type only if all edges in a set have the same type.</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># For all other attributes:</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co"># --&gt; Drop these attributes.</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>combinations <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  <span class="at">flow =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>  <span class="at">type =</span> <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">==</span> <span class="dv">1</span>) x[<span class="dv">1</span>] <span class="cf">else</span> <span class="st">&quot;unknown&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  <span class="st">&quot;ignore&quot;</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># Simplify the network with to_spatial_simple.</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>simple <span class="ot">=</span> <span class="fu">convert</span>(net, to_spatial_simple, <span class="at">summarise_attributes =</span> combinations)</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co"># Inspect our merged set of multiple edges.</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>simple <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">edge_is_between</span>(<span class="dv">6</span>, <span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; Simple feature collection with 1 feature and 5 fields
#&gt; Geometry type: LINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 4 ymin: 2 xmax: 4 ymax: 3
#&gt; CRS:           NA
#&gt; <span style="color: #555555;"># A tibble: 1 × 6</span>
#&gt;    from    to            x  flow type    .tidygraph_edge_index
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;LINESTRING&gt;</span> <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #555555; font-style: italic;">&lt;list&gt;</span>               
#&gt; <span style="color: #555555;">1</span>     6     7   (4 3, 4 2)    15 unknown <span style="color: #555555;">&lt;int [2]&gt;</span>
</CODE></PRE>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(net), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(simple), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEKklEQVR4nO3c7XKiMBhAYbDbXd16/9e7CNT6ATkMWRNePOdfp5DEp1O0JdqcLVlTewFbTyBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggaOtATVN5hRsHapraQtsGaprqQgLREmpOjglE9T7HY80VVJx7Qafep6bQ1oFOp+OxqtD2gSoLBQA6VxWKAFRVKARQTaEYQBWFggDVE4oCVE0oDFAtoThAlYQCAdURigRURSgUUA2hWEAVhIIBlReKBlRcKBxQaaF4QIWFAgKVFYoIVFQoJFBJoZhABYWCApUTigpUTCgsUCmhuECFhGpvT4KdCafUAcuEMjc/VN6dRHs3xs0LyTKnoCVmnJsd7m4ZD8gQyt5AIxCtcf2p+QmEsy+6Br12Cjo/a/bcDrT4z+wNeB+hn8UOXckDPrvypvjoyjlfIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIGj/QP7TPl3w2z4vBwp+41Ag6OVAhxFo/SD7BuqGH3zWj5ICyv/cFRqBgTLW0J16GIQuzPMDpaegrRW/c+pH+Ep0eQCp73/1I/xZVX/q8AMYfJrm71S0wSTtkyU0jpABNI6w2qcT6h/L5/jVnE9CaO9A9w9GoBmg9hVAJTYv4UU6Yw39qcP2s7Zt5wdafQ3aw7PYsEGvbQeh+eNSo6yd/r/04tdB/Q7G7vFfgNaOsWug8+BzEVo9xL6Bzke6BmM7B/KPVUogKvfFyu6BfmW+WNk/UFfO+QJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBu/9wk9hAeE9mvHGcLD1FaCC8qzcekCMkkEBvDLT4GjR/wM6BeBMbbX/aO9CC0r9GAoGQQOe0kECXEkIC9c0LCTQ0KyTQ2JyQQN/NCAl0bVpIoJ8mhQS6aUpIoNsmhAS661lIoPuehAR66FFIoMcehAR66l5IoOfuhASa6FZIoKluhASa7EdIoOmuQgLN9C0k0FyjkECztdeSh70v0FkgahlQ6Hc9Z7YEKPb75nNjoOCfvJCdQJRAub33NWhJ7/wsViKBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBoH+13djoPf6n1gAAAABJRU5ErkJggg==" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADdUlEQVR4nO3c0VLaQABA0VgVSuv/f28D4kNnas4MK4ak9z7paHbD0UnQXZjearFp7RN49AJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhB4daJpWPsMHB5qmtYUeG2iaVhcKSKew5uQsILW6z6MD/Vrb5+GB5tY9g4BQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYDQ2gu7WFn+gqXnwRFW3hmgvQnjmxdGR1h3a4l2t4xvfxkeISANMDD5cAFx9q5Byz3p5J+H72Ivm76LPc0tfsPz3NgUL3MjxweEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBof0D9U/75Ta+7HN3oI0vHAaE7g50vAIdbh5h30DH47vQ4XCz0BLQ/TcvGWjgHOZDj+9Cs8/h84GWp9DWih8jXUZ4XegMtPT118sIP2/qcugMND+Sd59p+v2vtMFk2WdI6DrCANB1hJt9ZqHLYzlcP/vMZ0Fo70B/P5iAPgH6cQ+g79i8xIv0wDlcDj2dzh9+/LBumWLfd7HT6Sz08ev8+fctjXLr9F/SnZ8HnX1O18vErWPsGujt3ecsdPMQ+wZ6O+kazHYO1B+rKiA1+mRl90Cvg09W9g80N3J8QCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBDa/ZubbBuIazLjO0w2DcRVveFlv4BYQGjTQF2DPL0e/n9+F/uGAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoW2/6vkb2vbr5u/fxt954f4FhAJSXYNUd7H7FhAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBD6A94g51g8IjovAAAAAElFTkSuQmCC" width="50%" /></p>
<p>When the edges table does not have attribute columns, using
<code>to_spatial_simple</code> does not have advantages and applying the
filter functions as shown before is faster.</p>
</div>
<div id="subdivide-edges" class="section level3">
<h3>Subdivide edges</h3>
<p>When constructing a sfnetwork from a set of sf linestrings, the
<em>endpoints</em> of those linestrings become nodes in the network. If
endpoints are shared between multiple lines, they become a single node,
and the edges are connected. However, a linestring geometry can also
contain <em>interior points</em> that define the shape of the line, but
are not its endpoints. It can happen that such an interior point in one
edge is <em>exactly</em> equal to either an interior point or endpoint
of another edge. In the network structure, however, these two edges are
not connected, because they don’t share <em>endpoints</em>. If this is
unwanted, we need to split these two edges at their shared point and
connect them accordingly.</p>
<p>In graph theory terms the process of splitting and edge is called
<em>subdivision</em>: the subdivision of an edge <span class="math inline">\(o = \{a, b\}\)</span> (i.e. an edge from node
<span class="math inline">\(a\)</span> to node <span class="math inline">\(b\)</span>) is the addition of a new node <span class="math inline">\(c\)</span> and the replacement of <span class="math inline">\(o\)</span> by two new edges <span class="math inline">\(p = \{a, c\}\)</span> and <span class="math inline">\(q = \{c, b\}\)</span>.</p>
<p>The function <code>to_spatial_subdivision()</code> subdivides edges
at interior points whenever these interior points are equal to one or
more interior points or endpoints of other edges, and recalculates
network connectivity afterwards.</p>
<p>To illustrate the workflow, lets consider a situation where an
interior point <span class="math inline">\(p_{x}\)</span> in edge <span class="math inline">\(x\)</span> is shared with point <span class="math inline">\(p_{y}\)</span> in edge <span class="math inline">\(y\)</span>. That gives two possible
situations:</p>
<ul>
<li><span class="math inline">\(p_{y}\)</span> is an interior point of
<span class="math inline">\(y\)</span>. Since <span class="math inline">\(p_{x}\)</span> and <span class="math inline">\(p_{y}\)</span> are both interior points, neither
of them is already a node in the network. Then:
<ul>
<li><span class="math inline">\(x\)</span> is subdivided at <span class="math inline">\(p_{x}\)</span> into two new edges <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> and new node <span class="math inline">\(p_{x}\)</span>.</li>
<li><span class="math inline">\(y\)</span> is subdivided at <span class="math inline">\(p_{y}\)</span> into two new edges <span class="math inline">\(y_{1}\)</span> and <span class="math inline">\(y_{2}\)</span> and new node <span class="math inline">\(p_{y}\)</span>.</li>
<li>The new nodes <span class="math inline">\(p_{x}\)</span> and <span class="math inline">\(p_{y}\)</span> are merged into a single node <span class="math inline">\(p\)</span> with the edge set <span class="math inline">\(\{x_{1}, x_{2}, y_{1}, y_{2}\}\)</span> as
incidents.</li>
</ul></li>
<li><span class="math inline">\(p_{y}\)</span> is and endpoint of <span class="math inline">\(y\)</span>. Since <span class="math inline">\(p_{y}\)</span> is an edge endpoint, it is already
a node in the network. Then:
<ul>
<li><span class="math inline">\(x\)</span> is subdivided at <span class="math inline">\(p_{x}\)</span> into two new edges <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> and new node <span class="math inline">\(p_{x}\)</span>.</li>
<li>The new node <span class="math inline">\(p_{x}\)</span> is merged
with node <span class="math inline">\(p_{y}\)</span> into a single node
<span class="math inline">\(p\)</span> with the edge set <span class="math inline">\(\{y, x_{1}, x_{2}\}\)</span> as incidents.</li>
</ul></li>
</ul>
<p>Note that an edge is <em>not</em> subdivided when it crosses another
edge at a location that is not an interior point or endpoint in the
linestring geometry of any of the two edges.</p>
<p>For our example network, this means:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>subdivision <span class="ot">=</span> <span class="fu">convert</span>(simple, to_spatial_subdivision)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; Warning: to_spatial_subdivision assumes attributes are constant over geometries</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(simple), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(simple, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(subdivision), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADdUlEQVR4nO3c0VLaQABA0VgVSuv/f28D4kNnas4MK4ak9z7paHbD0UnQXZjearFp7RN49AJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhB4daJpWPsMHB5qmtYUeG2iaVhcKSKew5uQsILW6z6MD/Vrb5+GB5tY9g4BQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYDQ2gu7WFn+gqXnwRFW3hmgvQnjmxdGR1h3a4l2t4xvfxkeISANMDD5cAFx9q5Byz3p5J+H72Ivm76LPc0tfsPz3NgUL3MjxweEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBof0D9U/75Ta+7HN3oI0vHAaE7g50vAIdbh5h30DH47vQ4XCz0BLQ/TcvGWjgHOZDj+9Cs8/h84GWp9DWih8jXUZ4XegMtPT118sIP2/qcugMND+Sd59p+v2vtMFk2WdI6DrCANB1hJt9ZqHLYzlcP/vMZ0Fo70B/P5iAPgH6cQ+g79i8xIv0wDlcDj2dzh9+/LBumWLfd7HT6Sz08ev8+fctjXLr9F/SnZ8HnX1O18vErWPsGujt3ecsdPMQ+wZ6O+kazHYO1B+rKiA1+mRl90Cvg09W9g80N3J8QCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBDa/ZubbBuIazLjO0w2DcRVveFlv4BYQGjTQF2DPL0e/n9+F/uGAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoW2/6vkb2vbr5u/fxt954f4FhAJSXYNUd7H7FhAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBD6A94g51g8IjovAAAAAElFTkSuQmCC" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADfElEQVR4nO3cy3KiQABAUfPQzMT8//cOvhazkFMFg4hz7yoL7MaTCKXdZvdTo+3WPoFnLyAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBA6NmBdruVz/DJgXa7tYWeG2i3W10oIJ3CmpOzgNTqPs8O9Httn6cHGlr3DAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCay/sYmX5Hyw9zxxh5Z0B2pswf/PC3BHW3Vqi3S3zt7/MHiEgDTBj8tkFxNm7Bo33rZP/mn0Xe9/0Xex7aPSAr6F5U7wPzXl8QCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBB6faA+tB9v48s+iwNtfOEwILQ40PEKtJ88wmsDHY8Xof1+stAY0PKblxZdeh4eerwIDT77+wONT6GtFe9zuv327nY+4NdI5wPeJnV+6AA0PJPRmbTBZNxnltDt9T/uMyZ0PWCyzyB0fi4jM+kq/upAfz+ZgO4Avd2faTrQIzYvzT8ADz0cTj/evKZMse5d7EMHfM44h7PPSej2F3X/uLFRpk7/T/oYGj3gc2j68Cefw/UlOnWMlwb6ufichCYP8dpAPwddg9mLA239zWpAaHmgjX9g9gAgvh9Grw+kT1RQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBBaGWjJtflL2wZacnfHtU0DcVVv9rJfQCwgtGmgrkGeXk//P7+LPaCAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEBo2996fkDb/t788m38Py8sX0AoINU1SHUXW7aAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGA0B8aZ+tK2TrmlAAAAABJRU5ErkJggg==" width="50%" /></p>
</div>
<div id="smooth-pseudo-nodes" class="section level3">
<h3>Smooth pseudo nodes</h3>
<p>A network may contain nodes that have only one incoming and one
outgoing edge. For tasks like calculating shortest paths, such nodes are
redundant, because they don’t represent a point where different
directions can possibly be taken. Sometimes, these type of nodes are
referred to as <em>pseudo nodes</em>. Note that their equivalent in
undirected networks is any node with only two incident edges, since
<em>incoming</em> and <em>outgoing</em> does not have a meaning there.
To reduce complexity of subsequent operations, we might want to get rid
of these pseudo nodes.</p>
<p>In graph theory terms this process is the opposite of subdivision and
also called <em>smoothing</em>: smoothing a node <span class="math inline">\(b\)</span> with incident edges <span class="math inline">\(o = \{a, b\}\)</span> and <span class="math inline">\(p = \{b, c\}\)</span> removes <span class="math inline">\(b\)</span>, <span class="math inline">\(o\)</span>
and <span class="math inline">\(p\)</span> and creates the new edge
<span class="math inline">\(q = \{a, c\}\)</span>.</p>
<p>The function <code>to_spatial_smooth()</code> iteratively smooths
pseudo nodes, and after each removal concatenates the linestring
geometries of the two affected edges together into a new, single
linestring geometry.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>smoothed <span class="ot">=</span> <span class="fu">convert</span>(subdivision, to_spatial_smooth)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(subdivision), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothed, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(smoothed), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothed, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADfElEQVR4nO3cy3KiQABAUfPQzMT8//cOvhazkFMFg4hz7yoL7MaTCKXdZvdTo+3WPoFnLyAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBA6NmBdruVz/DJgXa7tYWeG2i3W10oIJ3CmpOzgNTqPs8O9Httn6cHGlr3DAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCay/sYmX5Hyw9zxxh5Z0B2pswf/PC3BHW3Vqi3S3zt7/MHiEgDTBj8tkFxNm7Bo33rZP/mn0Xe9/0Xex7aPSAr6F5U7wPzXl8QCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBB6faA+tB9v48s+iwNtfOEwILQ40PEKtJ88wmsDHY8Xof1+stAY0PKblxZdeh4eerwIDT77+wONT6GtFe9zuv327nY+4NdI5wPeJnV+6AA0PJPRmbTBZNxnltDt9T/uMyZ0PWCyzyB0fi4jM+kq/upAfz+ZgO4Avd2faTrQIzYvzT8ADz0cTj/evKZMse5d7EMHfM44h7PPSej2F3X/uLFRpk7/T/oYGj3gc2j68Cefw/UlOnWMlwb6ufichCYP8dpAPwddg9mLA239zWpAaHmgjX9g9gAgvh9Grw+kT1RQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBBaGWjJtflL2wZacnfHtU0DcVVv9rJfQCwgtGmgrkGeXk//P7+LPaCAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEBo2996fkDb/t788m38Py8sX0AoINU1SHUXW7aAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGA0B8aZ+tK2TrmlAAAAABJRU5ErkJggg==" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADhklEQVR4nO3c3W7aSACAUbdh26Xk/Z+35udmtcVHYmKM6fddJSKeGR8pJmEM02ctNm29gFcvIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEDo1YGmaeMVvjjQNG0t9NpA07S5UEBawpaTs4DU5j6vDvTv1j4vDzS37QoCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQltv7GJn+QuABjevN74zQPcmjAON3v6w7a0lvLtlGGj4BpqANMDQ9IMFxNm7Bi3H+6PGgX7u+lmM5/8FQHMjxweEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBofcH6kX75Xa+7bM60M43DgNCqwMdb0CHh0d4b6Dj8Sp0ODwstAS0/udmeOt5YA3zocer0OxzuD/Q8hQLj13s/1m1yxTfFxpYw+XQGWg+k6vPNP34U7hG3X/o9tv7tSJ/OIcloYE13A49Xs7lcPvuns+C0LsD/fdkAvrf2NdzOa0B9IxPf+IUA2u4HPrxcf7ydDrdH+jha9AznsW+aYpfA2u4+JyFTqer0P2fWxrl0em/pG9ziz/wa+7x4c8+H/P5n4EeHeOtgT6vPmehh4d4b6DPD12D2ZsD7f2f1YDQ+kA7f8HsCUDfB/9YeX+guZHjA0IBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYDQxkBr7s1f2zfQmnd33No1EHf1hrf9AmIBoV0DdQ3y9Dr9v/xZ7AkFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJC+37X8xPa9/vm12/nn7ywfgGhgFTXINWz2LoFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhH4DqKzssWLBmEIAAAAASUVORK5CYII=" width="50%" />
There are different ways in which the smoothing process can be tuned.
Firstly, it is possible to specify how attributes of concatenated edges
should be summarized, just as with <code>to_spatial_simple()</code>.
That is, you can specify a single summarise technique to be applied to
all attributes (e.g. <code>summarise_attributes = &quot;sum&quot;</code>), a named
list with a different summarise technique per attribute
(e.g. <code>summarise_attributes = list(foo = &quot;sum&quot;, bar = &quot;mean&quot;)</code>),
or a named list including an unnamed default technique for those
attributes that where not mentioned
(e.g. <code>summarise_attributes = list(foo = &quot;sum&quot;, &quot;mean&quot;)</code>).
The techniques can be chosen from a set of pre-defined functions, but
can also be a custom function provided by you. See the <a href="https://igraph.org/r/doc/igraph-attribute-combination.html">igraph
documentation</a> for details. Note that the geometry-list column, the
tidygraph index column, as well as the <em>from</em> and <em>to</em>
columns are not attributes!</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># We know from before that our example network has two pseudo nodes.</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co"># Lets look at the attributes of their incident edges.</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>subdivision <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">edge_is_incident</span>(<span class="dv">2</span>) <span class="sc">|</span> <span class="fu">edge_is_incident</span>(<span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; Simple feature collection with 4 features and 5 fields
#&gt; Geometry type: LINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 0 ymin: 1 xmax: 4 ymax: 3
#&gt; CRS:           NA
#&gt; <span style="color: #555555;"># A tibble: 4 × 6</span>
#&gt;    from    to               x  flow type    .tidygraph_edge_index
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span>    <span style="color: #555555; font-style: italic;">&lt;LINESTRING&gt;</span> <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span>
#&gt; <span style="color: #555555;">1</span>     1     2 (0 1, 1 1, 2 1)     7 road                        1
#&gt; <span style="color: #555555;">2</span>     2     3      (2 1, 3 1)     2 road                        2
#&gt; <span style="color: #555555;">3</span>     8     9      (4 3, 4 2)    15 unknown                     5
#&gt; <span style="color: #555555;">4</span>     9     4      (4 2, 4 1)     2 road                        6
</CODE></PRE>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co"># Define how we want to combine the attributes.</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># For the flows:</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># --&gt; It makes sense to sum them when edges get merged.</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co"># For the type:</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co"># --&gt; Preserve the type only if all edges in a set have the same type.</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>combinations <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="at">flow =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="at">type =</span> <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">==</span> <span class="dv">1</span>) x[<span class="dv">1</span>] <span class="cf">else</span> <span class="st">&quot;unknown&quot;</span>,</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="st">&quot;ignore&quot;</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co"># Apply the morpher.</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>other_smoothed <span class="ot">=</span> <span class="fu">convert</span>(subdivision, to_spatial_smooth, <span class="at">summarise_attributes =</span> combinations)</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co"># Inspect our concatenated edges.</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>other_smoothed <span class="sc">%&gt;%</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;edges&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">edge_is_between</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">|</span> <span class="fu">edge_is_between</span>(<span class="dv">7</span>, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; Simple feature collection with 2 features and 5 fields
#&gt; Geometry type: LINESTRING
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 0 ymin: 1 xmax: 4 ymax: 3
#&gt; CRS:           NA
#&gt; <span style="color: #555555;"># A tibble: 2 × 6</span>
#&gt;    from    to  flow type    .tidygraph_edge_index                    x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #555555; font-style: italic;">&lt;list&gt;</span>                        <span style="color: #555555; font-style: italic;">&lt;LINESTRING&gt;</span>
#&gt; <span style="color: #555555;">1</span>     1     2     9 road    <span style="color: #555555;">&lt;int [2]&gt;</span>             (0 1, 1 1, 2 1, 3 1)
#&gt; <span style="color: #555555;">2</span>     7     3    17 unknown <span style="color: #555555;">&lt;int [2]&gt;</span>                  (4 3, 4 2, 4 1)
</CODE></PRE>
<p>Secondly, it is possible to only remove those pseudo nodes for which
attributes among their incident edges are equal. To do this, set
<code>require_equal = TRUE</code>. Optionally, you can provide a list of
attribute names instead, such that only those attributes are checked for
equality, instead of all attributes. Again, remember that the
geometry-list column, the tidygraph index column, as well as the
<em>from</em> and <em>to</em> columns are not considered attributes in
this case.</p>
<p>In our example, our first pseudo node has incident edges of the same
type (“road”), while the second pseudo node has incident edges of
differing types (“road” and “unknown”). If we require the type attribute
to be equal, the second pseudo node will not be removed.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>other_smoothed <span class="ot">=</span> <span class="fu">convert</span>(subdivision, to_spatial_smooth, <span class="at">require_equal =</span> <span class="st">&quot;type&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(subdivision), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(other_smoothed, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(smoothed), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(other_smoothed, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADfElEQVR4nO3cy3KiQABAUfPQzMT8//cOvhazkFMFg4hz7yoL7MaTCKXdZvdTo+3WPoFnLyAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBA6NmBdruVz/DJgXa7tYWeG2i3W10oIJ3CmpOzgNTqPs8O9Httn6cHGlr3DAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCay/sYmX5Hyw9zxxh5Z0B2pswf/PC3BHW3Vqi3S3zt7/MHiEgDTBj8tkFxNm7Bo33rZP/mn0Xe9/0Xex7aPSAr6F5U7wPzXl8QCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBB6faA+tB9v48s+iwNtfOEwILQ40PEKtJ88wmsDHY8Xof1+stAY0PKblxZdeh4eerwIDT77+wONT6GtFe9zuv327nY+4NdI5wPeJnV+6AA0PJPRmbTBZNxnltDt9T/uMyZ0PWCyzyB0fi4jM+kq/upAfz+ZgO4Avd2faTrQIzYvzT8ADz0cTj/evKZMse5d7EMHfM44h7PPSej2F3X/uLFRpk7/T/oYGj3gc2j68Cefw/UlOnWMlwb6ufichCYP8dpAPwddg9mLA239zWpAaHmgjX9g9gAgvh9Grw+kT1RQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBBaGWjJtflL2wZacnfHtU0DcVVv9rJfQCwgtGmgrkGeXk//P7+LPaCAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEBo2996fkDb/t788m38Py8sX0AoINU1SHUXW7aAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGA0B8aZ+tK2TrmlAAAAABJRU5ErkJggg==" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADcUlEQVR4nO3cy1KjQABAURyj0Yn//71DHi7DqQKRkLl35YJ0wymFMt3J8FWTDVufwKMXEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCD06EDDsPEZPjjQMGwt9NhAw7C5UEA6hS0nZwGpzX0eHejv1j4PDzS27RkEhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhLZe2MXK8g8sPS8cYeOdAdqbsHzzwtIRtt1aot0ty7e/LB4hIA2wYPLFBcTZuwdN96GTf138FHvf9VPsY2zygNexZVO8jy15fUAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQen6g3rSfbufLPqsD7XzhMCC0OtDhBnSaPcJzAx0OV6HTabbQFND635ux6tLz+NLDVWj0Od0faHoKba34s2qc4nLA26wuLx2Bxiu5+tyZSRtMpn3WFeIUtwNm+4xCl2s53Z9Jd/FnB+LFBHTubQ2g3/j2J06x4BwuLz0ezz9+e82ZYtun2Ium+FxwDhefs9D3b9T946ZGmTv9j/QyNnnA59j84c8+x9uf6Nwxnhro6+pzFpo9xHMDfR11D2ZPDrT3f1YDQusD7fwNs18A4v/D6PmB9I4KCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCGwOtuTZ/bd9Aa+7uuLVrIK7qLV72C4gFhHYN1D3I0+vy//On2C8UEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoI7ftTz7/Qvj83v347/+aF9QsIBaS6B6meYusWEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEPoHaaPoz3J079YAAAAASUVORK5CYII=" width="50%" />
Thirdly, it is also possible to directly specify a set of nodes that
should never be removed, even if they are a pseudo node. This can be
done by either providing a vector of node indices or a set of geospatial
points to the <code>protect</code> argument. In the latter case, the
function will protect the nearest node to each of these points. This can
be helpful when you already know you want to use this nodes at a later
stage for routing purposes. For example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>other_smoothed <span class="ot">=</span> <span class="fu">convert</span>(subdivision, to_spatial_smooth, <span class="at">protect =</span> <span class="dv">2</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(subdivision), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(subdivision, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(other_smoothed, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(smoothed), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(other_smoothed, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADfElEQVR4nO3cy3KiQABAUfPQzMT8//cOvhazkFMFg4hz7yoL7MaTCKXdZvdTo+3WPoFnLyAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBA6NmBdruVz/DJgXa7tYWeG2i3W10oIJ3CmpOzgNTqPs8O9Httn6cHGlr3DAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCay/sYmX5Hyw9zxxh5Z0B2pswf/PC3BHW3Vqi3S3zt7/MHiEgDTBj8tkFxNm7Bo33rZP/mn0Xe9/0Xex7aPSAr6F5U7wPzXl8QCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBB6faA+tB9v48s+iwNtfOEwILQ40PEKtJ88wmsDHY8Xof1+stAY0PKblxZdeh4eerwIDT77+wONT6GtFe9zuv327nY+4NdI5wPeJnV+6AA0PJPRmbTBZNxnltDt9T/uMyZ0PWCyzyB0fi4jM+kq/upAfz+ZgO4Avd2faTrQIzYvzT8ADz0cTj/evKZMse5d7EMHfM44h7PPSej2F3X/uLFRpk7/T/oYGj3gc2j68Cefw/UlOnWMlwb6ufichCYP8dpAPwddg9mLA239zWpAaHmgjX9g9gAgvh9Grw+kT1RQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBBaGWjJtflL2wZacnfHtU0DcVVv9rJfQCwgtGmgrkGeXk//P7+LPaCAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEBo2996fkDb/t788m38Py8sX0AoINU1SHUXW7aAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGA0B8aZ+tK2TrmlAAAAABJRU5ErkJggg==" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADgklEQVR4nO3c3VKbQACA0VRj0za+//OW/PQynBlWJKTfd+WMywJHBc1iDp8122HrA3j2AkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEnh3ocNj4CJ8c6HDYWui5gQ6HzYUC0iFsuXMWkNrc59mB3rb2eXqgqW2PICAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCC09cIuVpa/AGhw8XrjJwP0bMI40OjjD9s+WsKnW4aBhh+gCUgTDO1+sIC4965B8/1Z/y72c9d3sT9TswO+AGhqZPuAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIPT6QL1oP9/Ol31WB9r5wmFAaHWg4x3ovHiG1wY6Hm9C5/NioTmg8ffN0Axeeh44hmnT401o8jk/nmh+FzOfu9q/jXSd4WOm64BfM10H/FjUddMJaDqTm8+Dk8E16vGn7j+9oz5zQvcB8FkmdN/0eD2X8+OT0VX81YF4MgFd+nh8MsuBvuDdnzjD+ABsejpdPvz3tViyi23vYu8a8HvgGK4+F6F/362Px83NsnT3X9L71OyA31PLp7/4nO4/5EvneGmgz5vPRWjxFK8N9HnSNZi9ONDe/1gNCK0PtPMXzL4B6NfgLyuvDzQ1sn1AKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUENoYaM21+Vv7Blrz6Y57uwbiqt7wsl9ALCC0a6CuQd69Tv8/v4t9QwGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgNC+/+v5G9r3/82v387feWH9AkIBqa5BqrvYugWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWE/gLjgec3Gdx16gAAAABJRU5ErkJggg==" width="50%" /></p>
</div>
<div id="simplify-intersections" class="section level3">
<h3>Simplify intersections</h3>
<p>Especially in road networks you may find that intersections between
edges are not modelled by a single node. Instead, each leg of the
intersection has a dedicated edge. To simplify the topology of your
network, you might want to reduce such complex intersection structures
into a single node. Hence, we want to reduce a group of nodes into a
single node, while maintaining the connectivity of the network.</p>
<p>In graph theory terms this process is called <em>contraction</em>:
the contraction of a set of nodes <span class="math inline">\(P =
\{p_{1}, p_{2}, ..., p_{n}\}\)</span> is the replacement of <span class="math inline">\(S\)</span> and all its incident edges by a
<em>single</em> node <span class="math inline">\(p^{*}\)</span> and a
set of edges that connect <span class="math inline">\(p^{*}\)</span> to
all nodes that were adjacent to any node <span class="math inline">\(p_{i} \in P\)</span>.</p>
<p>The function <code>to_spatial_contracted()</code> contracts groups of
nodes based on a given grouping variable. The geometry of each
contracted node is the <em>centroid</em> of the original group members’
geometries. Moreover, the geometries of the edges that start or end at a
contracted node are updated such that their boundaries match the new
node geometries.</p>
<p>Grouping variables are internally forwarded to
<code>dplyr::group_by()</code>. That means you can group the nodes based
on any (combination of) attribute(s). However, in this case, we want to
group the nodes spatially, such that nodes that are very close to each
other in space will form a group and get contracted. To do so, we can
use any spatial clustering algorithm. In this example, we apply the
well-known DBSCAN algorithm as implemented in the R package
<code>dbscan</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Retrieve the coordinates of the nodes.</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>node_coords <span class="ot">=</span> smoothed <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;nodes&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="fu">st_coordinates</span>()</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co"># Cluster the nodes with the DBSCAN spatial clustering algorithm.</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co"># We set eps = 0.5 such that:</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co"># Nodes within a distance of 0.5 from each other will be in the same cluster.</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co"># We set minPts = 1 such that:</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co"># A node is assigned a cluster even if it is the only member of that cluster.</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>clusters <span class="ot">=</span> <span class="fu">dbscan</span>(node_coords, <span class="at">eps =</span> <span class="fl">0.5</span>, <span class="at">minPts =</span> <span class="dv">1</span>)<span class="sc">$</span>cluster</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co"># Add the cluster information to the nodes of the network.</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>clustered <span class="ot">=</span> smoothed <span class="sc">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;nodes&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cls =</span> clusters)</span></code></pre></div>
<p>Now we have assigned each node to a spatial cluster. However, we
forgot one important point. When simplifying intersections, it is not
only important that the contracted nodes are close to each other in
space. They should also be <em>connected</em>. Two nodes that are close
to each other but <em>not</em> connected, can never be part of the same
intersection. Hence, a group of nodes to be contracted should in this
case be located in the same <em>component</em> of the network. We can
use <code>tidygraph::group_components()</code> to assign a component
index to each node. Note that in our example network this is not so much
of use, since the whole network forms a single connected component. But
for the sake of completeness, we will still show it:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>clustered <span class="ot">=</span> clustered <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cmp =</span> <span class="fu">group_components</span>())</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">select</span>(clustered, cls, cmp)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A sfnetwork with</span> <span style="color: #555555;">14</span> <span style="color: #555555;">nodes and</span> <span style="color: #555555;">14</span> <span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span> <span style="color: #555555;">NA</span> <span style="color: #555555;">
#&gt; #
#&gt; # A directed simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # A tibble: 14 × 3</span>
#&gt;     cls   cmp       x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;POINT&gt;</span>
#&gt; <span style="color: #555555;">1</span>     1     1   (0 1)
#&gt; <span style="color: #555555;">2</span>     2     1   (3 1)
#&gt; <span style="color: #555555;">3</span>     3     1   (4 1)
#&gt; <span style="color: #555555;">4</span>     4     1 (5.8 1)
#&gt; <span style="color: #555555;">5</span>     5     1   (3 2)
#&gt; <span style="color: #555555;">6</span>     6     1   (3 0)
#&gt; <span style="color: #555555;"># ℹ 8 more rows</span>
#&gt; <span style="color: #555555;">#
#&gt; # A tibble: 14 × 6</span>
#&gt;    from    to  flow type  .tidygraph_edge_index            x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span> <span style="color: #555555; font-style: italic;">&lt;list&gt;</span>                <span style="color: #555555; font-style: italic;">&lt;LINESTRING&gt;</span>
#&gt; <span style="color: #555555;">1</span>     2     3     2 road  <span style="color: #555555;">&lt;int [1]&gt;</span>               (3 1, 4 1)
#&gt; <span style="color: #555555;">2</span>     3     4     2 path  <span style="color: #555555;">&lt;int [1]&gt;</span>             (4 1, 5.8 1)
#&gt; <span style="color: #555555;">3</span>     5     2     9 road  <span style="color: #555555;">&lt;int [1]&gt;</span>               (3 2, 3 1)
#&gt; <span style="color: #555555;"># ℹ 11 more rows</span>
</CODE></PRE>
<p>The combination of the cluster index and the component index can now
be used to define the groups of nodes to be contracted. Nodes that form
a group on their own will remain unchanged.</p>
<p>A point of attention is that contraction introduces new <em>multiple
edges</em> and/or <em>loop edges</em>. Multiple edges are introduced by
contraction when there are several connections between the same groups
of nodes. Loop edges are introduced by contraction when there are
connections within a group. Setting <code>simplify = TRUE</code> will
remove the multiple and loop edges after contraction. However, note that
this also removes multiple and loop edges that already existed before
contraction.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>contracted <span class="ot">=</span> <span class="fu">convert</span>(</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  clustered,</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  to_spatial_contracted,</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  cls, cmp,</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">TRUE</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothed, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(smoothed), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothed, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(contracted, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(contracted), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(contracted, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADhklEQVR4nO3c3W7aSACAUbdh26Xk/Z+35udmtcVHYmKM6fddJSKeGR8pJmEM02ctNm29gFcvIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEDo1YGmaeMVvjjQNG0t9NpA07S5UEBawpaTs4DU5j6vDvTv1j4vDzS37QoCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQltv7GJn+QuABjevN74zQPcmjAON3v6w7a0lvLtlGGj4BpqANMDQ9IMFxNm7Bi3H+6PGgX7u+lmM5/8FQHMjxweEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBofcH6kX75Xa+7bM60M43DgNCqwMdb0CHh0d4b6Dj8Sp0ODwstAS0/udmeOt5YA3zocer0OxzuD/Q8hQLj13s/1m1yxTfFxpYw+XQGWg+k6vPNP34U7hG3X/o9tv7tSJ/OIcloYE13A49Xs7lcPvuns+C0LsD/fdkAvrf2NdzOa0B9IxPf+IUA2u4HPrxcf7ydDrdH+jha9AznsW+aYpfA2u4+JyFTqer0P2fWxrl0em/pG9ziz/wa+7x4c8+H/P5n4EeHeOtgT6vPmehh4d4b6DPD12D2ZsD7f2f1YDQ+kA7f8HsCUDfB/9YeX+guZHjA0IBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYDQxkBr7s1f2zfQmnd33No1EHf1hrf9AmIBoV0DdQ3y9Dr9v/xZ7AkFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJC+37X8xPa9/vm12/nn7ywfgGhgFTXINWz2LoFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhH4DqKzssWLBmEIAAAAASUVORK5CYII=" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJFBMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL///873nTZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADD0lEQVR4nO3dzW6jMBhAUdrp9Pf933dQ1O34VHKIobp3G4Kts4CFPyXbVw3bVm/g7AWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCJ0daNsW7/DkQNu2WujcQNu2XCggbWHl4iwgtdzn7ECvq31OD7S3dgcBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBodUHuzhZvgPQ5OH14skAzSbMA82OP6wdLeF0yzTQ9ABNQLrB1PKTBcTVewaNez/+Lfbn0m+x973hBXcA2pv5fkAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEBoBHT872b46Hl6Dz56Hl8w+Ox27P9yaLclngfdLvg70+0OH4Mw3fD/j74HRw73GQl9XzDrMxLSfExAAR0F9Ihff+IS83uYXWLtW+xJS3xO7+HtuLfYA3raG17wuTe3xNvezPcDQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhxUAPOJu/NNADpjsuDaTZnHv8Q11AKCB0aaCeQV5+bvzrB10c6PgCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgEh/7jJuF8PNDv+8NuBpgdoAtIN7reXUxaQ6hmkeosdW0AoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEDoHzORtVHEUDJ7AAAAAElFTkSuQmCC" width="50%" /></p>
<p>One thing we did not mention yet: in the same way as
<code>to_spatial_simple()</code> allowed you to combine attributes of
multiple edges and <code>to_spatial_smooth()</code> allowed to combine
attributes of concatenated edges, <code>to_spatial_contracted()</code>
allows you to combine attributes of contracted nodes. It works exactly
the same: you can specify a single summarise technique to be applied to
all attributes (e.g. <code>summarise_attributes = &quot;sum&quot;</code>), a named
list with a different summarise technique per attribute
(e.g. <code>summarise_attributes = list(foo = &quot;sum&quot;, bar = &quot;mean&quot;)</code>),
or a named list including an unnamed default technique for those
attributes that where not mentioned
(e.g. <code>summarise_attributes = list(foo = &quot;sum&quot;, &quot;mean&quot;)</code>).
The techniques can be chosen from a set of pre-defined functions, but
can also be a custom function provided by you. See the <a href="https://igraph.org/r/doc/igraph-attribute-combination.html">igraph
documentation</a> for details. Note that the geometry-list column, the
tidygraph index column, as well as the <em>from</em> and <em>to</em>
columns are not attributes!</p>
<p>An example:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># Add some additional attribute columns to the nodes table.</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>clustered <span class="ot">=</span> clustered <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;nodes&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_priority =</span> <span class="fu">sample</span>(</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    <span class="fu">vcount</span>(clustered),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  ))</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co"># We know from before there is one group with several close, connected nodes.</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co"># Lets look at them.</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>clustered <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;nodes&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>  <span class="fu">filter</span>(cls <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> cmp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; Simple feature collection with 4 features and 4 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 5.8 ymin: 0.8 xmax: 6.2 ymax: 1.2
#&gt; CRS:           NA
#&gt; <span style="color: #555555;"># A tibble: 4 × 5</span>
#&gt;         x .tidygraph_node_index   cls   cmp is_priority
#&gt;   <span style="color: #555555; font-style: italic;">&lt;POINT&gt;</span>                 <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;int&gt;</span> <span style="color: #555555; font-style: italic;">&lt;lgl&gt;</span>      
#&gt; <span style="color: #555555;">1</span> (5.8 1)                     5     4     1 FALSE      
#&gt; <span style="color: #555555;">2</span> (6 0.8)                    11     4     1 FALSE      
#&gt; <span style="color: #555555;">3</span> (6 1.2)                    12     4     1 FALSE      
#&gt; <span style="color: #555555;">4</span> (6.2 1)                    14     4     1 FALSE
</CODE></PRE>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Define how we want to combine the attributes.</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co"># For the boolean is_priority variable:</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co"># --&gt; We want it to be TRUE if any of the nodes has a values of TRUE.</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co"># For the others, which were used as grouping variables:</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co"># --&gt; Drop these attributes.</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>combinations <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="at">is_priority =</span> <span class="cf">function</span>(x) <span class="fu">any</span>(x),</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>  <span class="st">&quot;ignore&quot;</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>)</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="co"># Contract with to_spatial_contracted.</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>contracted <span class="ot">=</span> <span class="fu">convert</span>(</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>  clustered,</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>  to_spatial_contracted,</span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>  cls, cmp,</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>  <span class="at">summarise_attributes =</span> combinations</span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>)</span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="co"># Inspect our contracted group of nodes.</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>contracted <span class="sc">%&gt;%</span></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">&quot;nodes&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; Simple feature collection with 1 feature and 2 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 6 ymin: 1 xmax: 6 ymax: 1
#&gt; CRS:           NA
#&gt; <span style="color: #555555;"># A tibble: 1 × 3</span>
#&gt;   .tidygraph_node_index is_priority       x
#&gt;   <span style="color: #555555; font-style: italic;">&lt;list&gt;</span>                <span style="color: #555555; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #555555; font-style: italic;">&lt;POINT&gt;</span>
#&gt; <span style="color: #555555;">1</span> <span style="color: #555555;">&lt;int [4]&gt;</span>             FALSE         (6 1)
</CODE></PRE>
</div>
<div id="overview" class="section level3">
<h3>Overview</h3>
<p>After applying all the network cleaning functions described in the
previous sections, we have cleaned our original network as follows:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(net), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(net, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(contracted, <span class="st">&quot;edges&quot;</span>), <span class="at">col =</span> <span class="fu">edge_colors</span>(contracted), <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(contracted, <span class="st">&quot;nodes&quot;</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJ1BMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL/7W/////w/5fjAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEKklEQVR4nO3c7XKiMBhAYbDbXd16/9e7CNT6ATkMWRNePOdfp5DEp1O0JdqcLVlTewFbTyBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggaOtATVN5hRsHapraQtsGaprqQgLREmpOjglE9T7HY80VVJx7Qafep6bQ1oFOp+OxqtD2gSoLBQA6VxWKAFRVKARQTaEYQBWFggDVE4oCVE0oDFAtoThAlYQCAdURigRURSgUUA2hWEAVhIIBlReKBlRcKBxQaaF4QIWFAgKVFYoIVFQoJFBJoZhABYWCApUTigpUTCgsUCmhuECFhGpvT4KdCafUAcuEMjc/VN6dRHs3xs0LyTKnoCVmnJsd7m4ZD8gQyt5AIxCtcf2p+QmEsy+6Br12Cjo/a/bcDrT4z+wNeB+hn8UOXckDPrvypvjoyjlfIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIGj/QP7TPl3w2z4vBwp+41Ag6OVAhxFo/SD7BuqGH3zWj5ICyv/cFRqBgTLW0J16GIQuzPMDpaegrRW/c+pH+Ep0eQCp73/1I/xZVX/q8AMYfJrm71S0wSTtkyU0jpABNI6w2qcT6h/L5/jVnE9CaO9A9w9GoBmg9hVAJTYv4UU6Yw39qcP2s7Zt5wdafQ3aw7PYsEGvbQeh+eNSo6yd/r/04tdB/Q7G7vFfgNaOsWug8+BzEVo9xL6Bzke6BmM7B/KPVUogKvfFyu6BfmW+WNk/UFfO+QJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBu/9wk9hAeE9mvHGcLD1FaCC8qzcekCMkkEBvDLT4GjR/wM6BeBMbbX/aO9CC0r9GAoGQQOe0kECXEkIC9c0LCTQ0KyTQ2JyQQN/NCAl0bVpIoJ8mhQS6aUpIoNsmhAS661lIoPuehAR66FFIoMcehAR66l5IoOfuhASa6FZIoKluhASa7EdIoOmuQgLN9C0k0FyjkECztdeSh70v0FkgahlQ6Hc9Z7YEKPb75nNjoOCfvJCdQJRAub33NWhJ7/wsViKBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBoH+13djoPf6n1gAAAABJRU5ErkJggg==" width="50%" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAJFBMVEUAAACAsdON08ez3mm8gL2+utrM68XZ2dn7gHL8zeX9tGL///873nTZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADD0lEQVR4nO3dzW6jMBhAUdrp9Pf933dQ1O34VHKIobp3G4Kts4CFPyXbVw3bVm/g7AWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCJ0daNsW7/DkQNu2WujcQNu2XCggbWHl4iwgtdzn7ECvq31OD7S3dgcBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBoYBQQCggFBAKCAWEAkIBodUHuzhZvgPQ5OH14skAzSbMA82OP6wdLeF0yzTQ9ABNQLrB1PKTBcTVewaNez/+Lfbn0m+x973hBXcA2pv5fkAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEBoBHT872b46Hl6Dz56Hl8w+Ox27P9yaLclngfdLvg70+0OH4Mw3fD/j74HRw73GQl9XzDrMxLSfExAAR0F9Ihff+IS83uYXWLtW+xJS3xO7+HtuLfYA3raG17wuTe3xNvezPcDQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhxUAPOJu/NNADpjsuDaTZnHv8Q11AKCB0aaCeQV5+bvzrB10c6PgCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgGhgFBAKCAUEAoIBYQCQgEh/7jJuF8PNDv+8NuBpgdoAtIN7reXUxaQ6hmkeosdW0AoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEAoIBQQCggFhAJCAaGAUEDoHzORtVHEUDJ7AAAAAElFTkSuQmCC" width="50%" /></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
